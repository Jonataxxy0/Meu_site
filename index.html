<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo da Cobrinha (Snake Game)</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #2c3e50; /* Azul escuro */
            color: white;
            font-family: 'Consolas', monospace;
            padding: 20px;
        }

        h1 {
            color: #f1c40f; /* Amarelo */
        }

        /* O elemento Canvas onde o jogo roda */
        #gameCanvas {
            border: 5px solid #2ecc71; /* Borda verde */
            background-color: #34495e; /* Fundo do mapa */
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        #scoreBoard {
            margin-top: 15px;
            font-size: 1.8em;
            color: #ecf0f1;
        }

        #controls {
            margin-top: 20px;
            font-size: 1.1em;
            color: #bdc3c7;
        }

        #message {
            margin-top: 10px;
            font-size: 1.5em;
            color: #e74c3c; /* Vermelho para mensagens de Game Over */
            height: 30px; /* Para evitar que a tela salte */
        }
        
        .restart-btn {
            padding: 10px 20px;
            font-size: 1.2em;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s;
        }

        .restart-btn:hover {
            background-color: #27ae60;
        }
    </style>
</head>
<body>

    <h1>üêç Jogo da Cobrinha</h1>

    <canvas id="gameCanvas" width="400" height="400"></canvas>

    <div id="scoreBoard">Pontua√ß√£o: 0</div>
    <div id="message"></div>
    <button class="restart-btn" onclick="startGame()">Reiniciar</button>
    <div id="controls">Use as setas (‚Üë ‚Üì ‚Üê ‚Üí) ou W, A, S, D para Mover.</div>

    <script>
        // --- Configura√ß√µes do Jogo ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreBoard = document.getElementById('scoreBoard');
        const messageDisplay = document.getElementById('message');

        const TILE_SIZE = 20; // Tamanho de cada bloco (20x20 pixels)
        const TILE_COUNT = canvas.width / TILE_SIZE; // 400/20 = 20 blocos por linha/coluna
        
        let snake = [];
        let food = {};
        let velocityX = 0;
        let velocityY = 0;
        let score = 0;
        let gameLoop;
        let isDead = false;
        let isChangingDirection = false; // Flag para evitar movimentos duplos por frame

        // --- Inicializa√ß√£o do Jogo ---

        function startGame() {
            // Limpa o loop anterior se houver
            clearInterval(gameLoop);
            
            // Reseta o estado do jogo
            score = 0;
            scoreBoard.textContent = `Pontua√ß√£o: 0`;
            messageDisplay.textContent = '';
            isDead = false;
            velocityX = 1; // Come√ßa se movendo para a direita
            velocityY = 0;
            isChangingDirection = false;

            // Cria a cobrinha inicial com 3 partes
            snake = [
                {x: 10, y: 10},
                {x: 9, y: 10},
                {x: 8, y: 10}
            ];

            // Gera a primeira comida
            spawnFood();
            
            // Inicia o loop do jogo (velocidade: 100ms por frame)
            gameLoop = setInterval(updateGame, 100);
        }

        // --- L√≥gica da Cobrinha e Comida ---

        function spawnFood() {
            let newX, newY;
            let collision;

            do {
                collision = false;
                // Gera posi√ß√µes aleat√≥rias dentro dos limites do TILE_COUNT (0 a 19)
                newX = Math.floor(Math.random() * TILE_COUNT);
                newY = Math.floor(Math.random() * TILE_COUNT);

                // Garante que a comida n√£o apare√ßa em cima da cobrinha
                for (let part of snake) {
                    if (part.x === newX && part.y === newY) {
                        collision = true;
                        break;
                    }
                }
            } while (collision);

            food = {x: newX, y: newY};
        }

        function changeDirection(event) {
            if (isChangingDirection || isDead) return;

            const key = event.key;
            let newX = velocityX;
            let newY = velocityY;

            switch (key) {
                // Setas
                case 'ArrowUp':
                case 'w':
                case 'W':
                    if (velocityY !== 1) { newX = 0; newY = -1; } // N√£o pode ir para tr√°s
                    break;
                case 'ArrowDown':
                case 's':
                case 'S':
                    if (velocityY !== -1) { newX = 0; newY = 1; }
                    break;
                case 'ArrowLeft':
                case 'a':
                case 'A':
                    if (velocityX !== 1) { newX = -1; newY = 0; }
                    break;
                case 'ArrowRight':
                case 'd':
                case 'D':
                    if (velocityX !== -1) { newX = 1; newY = 0; }
                    break;
            }
            
            // S√≥ atualiza a dire√ß√£o se houver mudan√ßa e se n√£o for parado (0, 0)
            if (newX !== velocityX || newY !== velocityY) {
                 velocityX = newX;
                 velocityY = newY;
                 isChangingDirection = true; // Impede outra mudan√ßa at√© o pr√≥ximo frame
            }
        }

        // --- Desenho e Atualiza√ß√£o do Canvas ---

        function drawGame() {
            // Limpa o canvas para o pr√≥ximo frame
            ctx.fillStyle = '#34495e';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Desenha a Comida (Amarela)
            ctx.fillStyle = '#f1c40f'; // Amarelo
            ctx.fillRect(food.x * TILE_SIZE, food.y * TILE_SIZE, TILE_SIZE, TILE_SIZE);

            // Desenha a Cobrinha
            ctx.fillStyle = '#2ecc71'; // Corpo Verde
            ctx.strokeStyle = '#27ae60'; // Borda Verde Escura
            for (let i = 0; i < snake.length; i++) {
                ctx.fillRect(snake[i].x * TILE_SIZE, snake[i].y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
                ctx.strokeRect(snake[i].x * TILE_SIZE, snake[i].y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
            }
        }

        function updateGame() {
            if (isDead) return;
            
            // O movimento foi processado, a flag pode ser resetada
            isChangingDirection = false; 

            // 1. Calcula a Nova Cabe√ßa
            const head = {x: snake[0].x + velocityX, y: snake[0].y + velocityY};

            // 2. Checa Colis√µes
            
            // Colis√£o com as Paredes
            if (head.x < 0 || head.x >= TILE_COUNT || head.y < 0 || head.y >= TILE_COUNT) {
                return endGame();
            }

            // Colis√£o com o Pr√≥prio Corpo
            for (let i = 1; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    return endGame();
                }
            }

            // 3. Verifica se Comeu a Comida
            if (head.x === food.x && head.y === food.y) {
                score++;
                scoreBoard.textContent = `Pontua√ß√£o: ${score}`;
                snake.unshift(head); // Adiciona a nova cabe√ßa (corpo cresce)
                spawnFood();         // Gera nova comida
                // O corpo N√ÉO √© removido no final, ent√£o a cobra aumenta.
            } else {
                snake.unshift(head); // Adiciona a nova cabe√ßa
                snake.pop();         // Remove a √∫ltima parte do corpo (movimento normal)
            }

            // 4. Desenha o Jogo
            drawGame();
        }

        function endGame() {
            isDead = true;
            clearInterval(gameLoop);
            messageDisplay.textContent = `FIM DE JOGO! Voc√™ fez ${score} pontos.`;
            // Deixa a cabe√ßa da cobra vermelha para indicar o fim
            if (snake.length > 0) {
                 ctx.fillStyle = '#e74c3c'; // Vermelho
                 ctx.fillRect(snake[0].x * TILE_SIZE, snake[0].y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
                 ctx.strokeRect(snake[0].x * TILE_SIZE, snake[0].y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
            }
        }

        // --- Event Listeners ---
        document.addEventListener('keydown', changeDirection);

        // Inicia o jogo quando a p√°gina carrega
        startGame();

    </script>
</body>
</html>
