<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini GTA 2D - Top Down</title>
    <style>
        /* Estilos CSS para o Jogo */
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #1a1a1a;
            color: white;
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
        }

        #game-map {
            width: 500px;
            height: 500px;
            background-color: #333; /* Cor do fundo da cidade/rua */
            border: 5px solid #555;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.7);
        }

        #player {
            width: 30px;
            height: 30px;
            background-color: #ff0000; /* Carro Vermelho/Player */
            position: absolute;
            top: 235px;
            left: 235px;
            border-radius: 5px;
            z-index: 10;
            transition: background-color 0.1s;
        }

        .road {
            background-color: #444;
            position: absolute;
            z-index: 1;
        }

        .vertical {
            width: 100px;
            height: 500px;
        }

        .horizontal {
            width: 500px;
            height: 100px;
        }
        
        /* Obst√°culos (pr√©dios) */
        .building {
            width: 80px;
            height: 80px;
            background-color: #0056b3; /* Cor dos Pr√©dios */
            position: absolute;
            border: 2px solid #003a72;
            z-index: 5;
            border-radius: 3px;
        }

        /* Item para coletar (Dinheiro/Power-up) */
        .collectible {
            width: 20px;
            height: 20px;
            background-color: gold;
            position: absolute;
            border-radius: 50%;
            z-index: 8;
            animation: pulse 1s infinite alternate;
        }

        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }

        #info {
            margin-top: 15px;
            font-size: 1.2em;
            display: flex;
            gap: 40px;
        }

        #status-message {
            margin-top: 20px;
            font-size: 1.5em;
            color: #ffcc00;
        }
    </style>
</head>
<body>

    <h1>Mini GTA 2D: City Driver</h1>

    <div id="game-map">
        <div class="road vertical" style="left: 200px; top: 0;"></div>
        <div class="road horizontal" style="left: 0; top: 200px;"></div>

        <div class="building" id="b1" style="left: 50px; top: 50px;"></div>
        <div class="building" id="b2" style="left: 370px; top: 50px;"></div>
        <div class="building" id="b3" style="left: 50px; top: 370px;"></div>
        <div class="building" id="b4" style="left: 370px; top: 370px;"></div>

        <div id="player"></div>
    </div>

    <div id="info">
        <div id="score">üí∞ Dinheiro: 0</div>
        <div id="health">‚ù§Ô∏è Vida: 100%</div>
    </div>
    
    <div id="status-message">Use W, A, S, D para Mover</div>

    <script>
        const player = document.getElementById('player');
        const gameMap = document.getElementById('game-map');
        const scoreDisplay = document.getElementById('score');
        const healthDisplay = document.getElementById('health');
        const statusMessage = document.getElementById('status-message');
        
        let playerX = 235;
        let playerY = 235;
        const playerSize = 30;
        const speed = 5;
        let score = 0;
        let health = 100;

        const mapWidth = 500;
        const mapHeight = 500;
        
        let keys = {};
        let gameLoopInterval;

        // --- Configura√ß√£o dos Obst√°culos (Pr√©dios) ---
        const obstacles = [];
        document.querySelectorAll('.building').forEach(el => {
            const rect = el.getBoundingClientRect();
            // Calcula a posi√ß√£o relativa ao mapa
            const mapRect = gameMap.getBoundingClientRect();
            obstacles.push({
                x: el.offsetLeft,
                y: el.offsetTop,
                width: el.offsetWidth,
                height: el.offsetHeight
            });
        });

        // --- Fun√ß√µes Principais ---

        function updatePlayerPosition() {
            player.style.left = playerX + 'px';
            player.style.top = playerY + 'px';
        }

        function isColliding(newX, newY, obstaclesList) {
            const playerRect = {
                left: newX,
                top: newY,
                right: newX + playerSize,
                bottom: newY + playerSize
            };

            for (const obs of obstaclesList) {
                const obsRect = {
                    left: obs.x,
                    top: obs.y,
                    right: obs.x + obs.width,
                    bottom: obs.y + obs.height
                };

                // Detec√ß√£o de colis√£o AABB (Axis-Aligned Bounding Box)
                if (playerRect.left < obsRect.right &&
                    playerRect.right > obsRect.left &&
                    playerRect.top < obsRect.bottom &&
                    playerRect.bottom > obsRect.top) {
                    return true;
                }
            }
            return false;
        }

        function checkBoundary(newX, newY) {
            if (newX < 0 || newX > mapWidth - playerSize ||
                newY < 0 || newY > mapHeight - playerSize) {
                return false; // Colis√£o com o limite do mapa
            }
            return true;
        }

        function gameLoop() {
            let newX = playerX;
            let newY = playerY;

            if (keys['w'] || keys['W']) newY -= speed;
            if (keys['s'] || keys['S']) newY += speed;
            if (keys['a'] || keys['A']) newX -= speed;
            if (keys['d'] || keys['D']) newX += speed;

            // 1. Verificar Colis√£o com Pr√©dios (Obst√°culos Fixos)
            if (!isColliding(newX, newY, obstacles) && checkBoundary(newX, newY)) {
                playerX = newX;
                playerY = newY;
            } else {
                // Colis√£o detectada: causar dano (simulando bater no pr√©dio)
                if (health > 0) {
                    health = Math.max(0, health - 1);
                    healthDisplay.textContent = `‚ù§Ô∏è Vida: ${health}%`;
                    player.style.backgroundColor = 'orange'; // Feedback visual de dano
                    setTimeout(() => player.style.backgroundColor = 'red', 100);
                }
                if (health === 0) {
                    endGame("Voc√™ bateu o carro demais! Jogo encerrado.");
                }
            }

            // 2. Checar Colet√°veis
            document.querySelectorAll('.collectible').forEach(collectible => {
                const colX = collectible.offsetLeft;
                const colY = collectible.offsetTop;
                const colSize = 20;

                const dx = playerX - colX;
                const dy = playerY - colY;
                
                // Dist√¢ncia simples para checar colis√£o com colet√°vel
                if (Math.abs(dx) < playerSize && Math.abs(dy) < playerSize) {
                    score += 10;
                    scoreDisplay.textContent = `üí∞ Dinheiro: ${score}`;
                    collectible.remove();
                    // Gera um novo colet√°vel
                    setTimeout(spawnCollectible, 500);
                }
            });

            updatePlayerPosition();
        }

        function spawnCollectible() {
            const collectible = document.createElement('div');
            collectible.classList.add('collectible');
            
            let randomX, randomY;
            let isSafe = false;
            
            // Loop para garantir que o colet√°vel n√£o spawne dentro de um pr√©dio
            while (!isSafe) {
                randomX = Math.floor(Math.random() * (mapWidth - 20));
                randomY = Math.floor(Math.random() * (mapHeight - 20));
                
                if (!isColliding(randomX, randomY, obstacles)) {
                    isSafe = true;
                }
            }

            collectible.style.left = randomX + 'px';
            collectible.style.top = randomY + 'px';
            gameMap.appendChild(collectible);
        }

        function endGame(message) {
            clearInterval(gameLoopInterval);
            statusMessage.textContent = `FIM DE JOGO! ${message} | Pontua√ß√£o final: ${score}`;
            alert(statusMessage.textContent);
        }

        // --- Event Listeners ---

        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        // --- In√≠cio do Jogo ---

        function startGame() {
            updatePlayerPosition();
            spawnCollectible(); // Come√ßa com um item para coletar
            gameLoopInterval = setInterval(gameLoop, 20); // 50 FPS
        }

        startGame();
    </script>
</body>
</html>
